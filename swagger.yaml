openapi: 3.0.0
info:
  title: "필기 공유 플랫폼 API"
  description: "회원가입, 이메일 인증, 통합 업로드(정보저장+URL발급), AI 요약 기능을 제공하는 API 명세서입니다."
  version: "1.0.0"

servers:
  - url: "http://localhost:8080/api/v1"
    description: "로컬 개발 서버"

tags:
  - name: Auth
    description: "회원가입, 로그인, 이메일 인증"
  - name: Notes
    description: "필기 업로드(통합), 조회, 상세보기"
  - name: Recommendation
    description: "Trending, For You (맞춤 추천)"
  - name: Users
    description: "Top Contributors 및 유저 프로필"

paths:
  # ==========================================
  # [Auth] 회원가입 및 로그인
  # ==========================================
  /auth/signup:
    post:
      tags:
        - Auth
      summary: "회원가입"
      description: "연세대 이메일 + 인증코드로 회원가입을 완료합니다."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - username
                - code
              properties:
                email:
                  type: string
                  description: "@yonsei.ac.kr 이메일"
                  example: "test@yonsei.ac.kr"
                password:
                  type: string
                  description: "비밀번호"
                  example: "password123!"
                username:
                  type: string
                  description: "닉네임(고유)"
                  example: "runner123"
                code:
                  type: string
                  description: "이메일 인증코드 (6자리)"
                  example: "123456"
      responses:
        "201":
          description: "회원가입 성공"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "회원가입이 완료되었습니다."
                  userId:
                    type: integer

  /auth/login:
    post:
      tags:
        - Auth
      summary: "로그인"
      description: "이메일과 비밀번호로 로그인하여 토큰을 발급받습니다."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  example: "test@yonsei.ac.kr"
                password:
                  type: string
                  example: "password123!"
      responses:
        "200":
          description: "로그인 성공"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthToken"

  /auth/email-code:
    post:
      tags:
        - Auth
      summary: "이메일 인증코드 발송"
      description: "@yonsei.ac.kr 이메일로 6자리 인증코드를 보냅니다."
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  example: "test@yonsei.ac.kr"
      responses:
        "200":
          description: "코드 발송 완료"
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "인증 코드가 발송되었습니다."

  # ==========================================
  # [Notes] 필기 업로드 (통합) & 목록 조회
  # ==========================================
  /notes:
    post:
      tags:
        - Notes
      summary: "필기 정보 등록 및 업로드 URL 발급"
      description: "필기 메타데이터(과목, 교수님 등)를 저장함과 동시에, S3에 파일을 올릴 수 있는 Presigned URL을 반환합니다."
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - fileName
                - fileType
                - semester
                - major
                - subject
              properties:
                fileName:
                  type: string
                  description: "업로드할 파일의 이름 (확장자 포함)"
                  example: "operating_system_week1.pdf"
                fileType:
                  type: string
                  description: "파일의 MIME 타입"
                  example: "application/pdf"
                semester:
                  type: string
                  description: "학기"
                  example: "2024-1"
                major:
                  type: string
                  description: "학과"
                  example: "컴퓨터과학과"
                subject:
                  type: string
                  description: "과목명"
                  example: "운영체제"
                professor:
                  type: string
                  description: "교수님 성함"
                  example: "김연세"
                description:
                  type: string
                  description: "추가 설명 (선택사항)"
      responses:
        "201":
          description: "정보 저장 완료 및 URL 발급"
          content:
            application/json:
              schema:
                type: object
                properties:
                  noteId:
                    type: integer
                    description: "생성된 노트 ID"
                  presignedUrl:
                    type: string
                    description: "S3에 파일을 PUT 할 수 있는 URL"
                  fileKey:
                    type: string
                    description: "S3에 저장될 파일 경로"

    get:
      tags:
        - Notes
      summary: "필기 목록 조회 (전체/카테고리/Trending)"
      description: "sort=latest(기본), sort=likes(Trending), category/semester/major/subject 필터"
      security:
        - bearerAuth: [ ]
      parameters:
        - in: query
          name: sort
          schema:
            type: string
            enum: [ latest, likes ]
            default: latest
        - in: query
          name: category
          schema:
            type: string
          description: "학과 이름"
        - in: query
          name: semester
          schema:
            type: string
          description: "학기 (예: 2024-1)"
        - in: query
          name: major
          schema:
            type: string
          description: "학과명"
        - in: query
          name: subject
          schema:
            type: string
          description: "과목명"
      responses:
        "200":
          description: "필기 목록 반환"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NoteSummary"

  # ==========================================
  # [Notes] 상세 보기 및 인터랙션
  # ==========================================
  /notes/{noteId}:
    get:
      tags:
        - Notes
      summary: "필기 상세 정보 조회"
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: noteId
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: "상세 정보 반환"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NoteDetail"

  /notes/{noteId}/interaction:
    post:
      tags:
        - Notes
      summary: "좋아요 / 싫어요 액션"
      description: "저장(Save)과 공유(Share)는 프론트엔드에서 처리하므로 제외됨"
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: noteId
          required: true
          schema:
            type: integer
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                type:
                  type: string
                  enum: [ like, dislike ]
      responses:
        "200":
          description: "반영 성공"

  # ==========================================
  # [Recommendation] For You
  # ==========================================
  /notes/for-you:
    get:
      tags:
        - Recommendation
      summary: "For You (맞춤 추천)"
      description: "로그인 유저 기준 추천"
      security:
        - bearerAuth: [ ]
      responses:
        "200":
          description: "추천 필기 목록"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NoteSummary"

  # ==========================================
  # [Users] 유저 관련 (다른 필기, Top Contributors)
  # ==========================================
  /users/{userId}/notes:
    get:
      tags:
        - Notes
      summary: "특정 업로더의 다른 필기 보기"
      security:
        - bearerAuth: [ ]
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: integer
      responses:
        "200":
          description: "해당 유저의 필기 목록"

  /users/top-contributors:
    get:
      tags:
        - Users
      summary: "Top Contributors"
      description: "업로드 수 기준 유저 랭킹"
      security:
        - bearerAuth: [ ]
      responses:
        "200":
          description: "상위 기여자 목록"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    userId:
                      type: integer
                    username:
                      type: string
                    uploadCount:
                      type: integer
                    rank:
                      type: integer

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    AuthToken:
      type: object
      properties:
        token:
          type: string
          description: "Access Token (JWT)"
        user:
          type: object
          properties:
            id:
              type: integer
            email:
              type: string
            username:
              type: string

    NoteSummary:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        thumbnailUrl:
          type: string
        major:
          type: string
        likes:
          type: integer
        createdAt:
          type: string
          format: date-time
          description: "업로드 일시"

    NoteDetail:
      type: object
      properties:
        id:
          type: integer
        title:
          type: string
        semester:
          type: string
        professor:
          type: string
        aiSummary:
          type: string
        difficulty:
          type: string
          enum: [ Easy, Medium, Hard ]
        estimatedTime:
          type: string
        uploader:
          type: object
          properties:
            id:
              type: integer
            username:
              type: string
        stats:
          type: object
          properties:
            likes:
              type: integer
            dislikes:
              type: integer
        createdAt:
          type: string
          format: date-time
          description: "업로드 일시"
